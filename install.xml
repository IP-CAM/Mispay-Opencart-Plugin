<?xml version="1.0" encoding="UTF-8"?>
<modification>
    <name><![CDATA[MISPay Payment Gateway]]></name>
    <version><![CDATA[1.0.2]]></version>
    <code><![CDATA[Barion Payment Method]]></code>
    <author><![CDATA[MISPay]]></author>
    <link><![CDATA[https://mispay.co]]></link>
   
    <file path="catalog/controller/checkout/checkout.php">
        <operation>
            <search><![CDATA[$data['footer'] = $this->load->controller('common/footer');]]></search>
            <add position="before"><![CDATA[
        // Load MISPay widget if enabled
        if ($this->config->get('payment_mispay_enable_widget')) {
            $data['mispay_widget'] = $this->load->controller('extension/payment/mispay/getWidget');
        }
            ]]></add>
        </operation>
    </file>
    
    <file path="catalog/view/theme/default/template/checkout/checkout.twig">
        <operation>
            <search><![CDATA[{{ footer }}]]></search>
            <add position="before"><![CDATA[
    {% if mispay_widget %}
    <div class="mispay-widget-container">
        {{ mispay_widget }}
    </div>
    {% endif %}
            ]]></add>
        </operation>
    </file>
    
    <file path="catalog/controller/product/product.php">
        <operation>
            <search><![CDATA[$data['footer'] = $this->load->controller('common/footer');]]></search>
            <add position="before"><![CDATA[
        // Load MISPay widget if enabled
        if ($this->config->get('payment_mispay_enable_widget')) {
            $this->load->model('extension/payment/mispay');
            $product_id = isset($this->request->get['product_id']) ? (int)$this->request->get['product_id'] : 0;
            $data['mispay_widget'] = $this->model_extension_payment_mispay->getProductWidget($product_id);
        }
            ]]></add>
        </operation>
    </file>
    
    <file path="catalog/view/theme/*/template/product/product.twig" error="skip">
        <operation>
            <search><![CDATA[{% if options %}]]></search>
            <add position="before"><![CDATA[
    {% if mispay_widget %}
    <div class="mispay-widget-container" style="margin-top: 15px; margin-bottom: 15px;">
        {{ mispay_widget }}
    </div>
    {% else %}
    <!-- MISPay Widget Debug: Widget is empty or disabled -->
    {% endif %}
            ]]></add>
        </operation>
     
        
    </file>
   <file path="catalog/controller/checkout/cart.php">
        <operation>
            <search><![CDATA[$data['footer'] = $this->load->controller('common/footer');]]></search>
            <add position="before"><![CDATA[
        // Load MISPay widget if enabled
        if ($this->config->get('payment_mispay_enable_widget')) {
            $this->load->model('extension/payment/mispay');
           
            $data['mispay_widget'] = $this->model_extension_payment_mispay->getWidget();
        }
            ]]></add>
        </operation>
    </file>
    
    <file path="catalog/view/theme/*/template/checkout/cart.twig">
        <operation>
            <search><![CDATA[{{ button_shopping }}]]></search>
            <add position="before" offset="1"><![CDATA[
    {% if mispay_widget %}
    <div class="mispay-widget-container" style="margin-top: 15px; margin-bottom: 15px;">
        {{ mispay_widget }}
    </div>
    {% else %}
    <!-- MISPay Widget Debug: Widget is empty or disabled -->
    {% endif %}
            ]]></add>
        </operation>
    </file>
   
</modification> 
